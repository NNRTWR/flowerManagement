<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Flower Management Web Application</title>
    <link th:rel="stylesheet" th:href="@{/css/output.css}">

</head>
<h1>รายการออเดอร์</h1>


<table class="table">
    <thead>
    <tr>
        <th>Order No</th>
        <th>Flower Type</th>
        <th>Amount</th>
        <th>Order Method</th>
    </tr>
    </thead>
    <tbody id="invoiceTable">
    <!-- Sample rows for demonstration -->
    <tr th:each="invoice : ${invoices}">
        <td th:text="${invoice.OID}"></td>
        <td th:text="${invoice.FName}"></td>
        <td th:text="${invoice.orderQuantity}"></td>
        <td th:text="${invoice.plant_status}"></td>
        <td th:text="${invoice.order_method}"></td>
        <!--                            <td style="text-align: right" th:text="${#numbers.formatDecimal(order.price, 1, 'COMMA', 2, 'POINT')}">-->
        <!--                            </td>-->
    </tr>
    <!-- Add more rows as needed -->
    </tbody>
</table>

<form id="invoiceForm" th:action="@{/invoiceConfirm}" method="POST">
    <label for="order_id">เลือกหมายเลขออเดอร์:</label>
    <select id="order_id" name="order_id">
        <option value="0" data-fid="0">select option</option>
        <option th:each="option : ${options}" th:value="${option.getOID()}" th:text="${option.getOID()}" th:attr="data-fid=${option.getFID()}"></option>
    </select>
    <button type="submit" id="confirmButton">สรุป</button>
</form>

<form id="invoiceFormSubmit" th:action="@{/invoiceCompleteButton}" method="POST" >
    <div id="summary" >
        <h2>สรุปรายการ</h2>
        <p>หมายเลขออเดอร์: <span id="orderNumber" th:text="${invoice.OID}"></span></p>
        <p>ประเภทการสั่ง: <span id="orderMethod" th:text="${invoice.order_method}"></span></p>
        <p>ชนิดดอกไม้: <span id="flowerType" th:text="${invoice.FName}"></span></p>
        <p>จำนวนดอกไม้: <span id="quantity" th:text="${invoice.orderQuantity}"></span></p>
        <p>จำนวนคงเหลือ: <span id="remain" th:text="${stock.total}"></span></p> 
        <p>สถานะของออเดอร์: <span id="status" th:text="${invoice.status}"></span></p>
        <p>ราคาสุทธิ: <span id="price" th:text="${invoice.price}"></span></p>
    </div>

    <input type="hidden" name="OID" th:value="${invoice.OID}" />
    <input type="hidden" name="SID" th:value="${stock.SID}" />
    <input type="hidden" name="amount" th:value="${invoice.price}" />
    <input type="hidden" name="orderQuantity" th:value="${invoice.orderQuantity}" />
    <button id="completeButton" disabled >ยืนยัน</button>
</form>

<script>
    document.getElementById("invoiceForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission
        let selectedOrderId = document.getElementById("order_id").value;
        let selectedOption = document.querySelector('option[value="' + selectedOrderId + '"]');
        let selectedFID = selectedOption.getAttribute("data-fid");
        let selectedOID = selectedOption.value;

        // Create hidden input fields for FID and OID
        let fidInput = document.createElement("input");
        fidInput.type = "hidden";
        fidInput.name = "FID"; // This should match the parameter name in your controller method
        fidInput.value = selectedFID;

        let oidInput = document.createElement("input");
        oidInput.type = "hidden";
        oidInput.name = "OID"; // This should match the parameter name in your controller method
        oidInput.value = selectedOID;

        // Append the hidden input fields to the form
        let form = document.getElementById("invoiceForm");
        form.appendChild(fidInput);
        form.appendChild(oidInput);

        // Submit the form
        form.submit();

    });

    let status = document.getElementById("status").textContent.trim(); // Get the status text
    let completeButton = document.getElementById("completeButton");

    if (status === "CANCELED" || status === "COMPLETED" || parseInt(document.getElementById("quantity").textContent) > parseInt(document.getElementById("remain").textContent) || status==="") {
        completeButton.disabled = true;
    } else {
        completeButton.disabled = false;
    }
</script>
</body>
</html>